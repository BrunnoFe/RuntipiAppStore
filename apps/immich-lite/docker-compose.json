{
  "version": "3.7",
  "services": {
    "immich": {
      "image": "ghcr.io/immich-app/immich-server:release",
      "container_name": "immich_server_lite",
      "volumes": [
        "/mnt/1TB_HDD/immich:/usr/src/app/upload",
        "/etc/localtime:/etc/localtime:ro"
      ],
      "environment": {
        "NODE_ENV": "production",
        "DB_HOSTNAME": "immich-db",
        "DB_USERNAME": "tipi",
        "DB_PASSWORD": "${APP_PASSWORD}",
        "DB_DATABASE_NAME": "immich",
        "REDIS_HOSTNAME": "immich-redis",
        "IMMICH_MACHINE_LEARNING_ENABLED": "false"
      },
      "devices": [
        "/dev/dri:/dev/dri"
      ],
      "depends_on": [
        "immich-redis",
        "immich-db"
      ],
      "networks": [
        "tipi_main_network",
        "default"
      ],
      "ports": [
        "${APP_PORT}:2283"
      ],
      "labels": {
        "runtipi.managed": "true",
        "runtipi.appurn": "immich-lite"
      },
      "restart": "unless-stopped",
      "deploy": {
        "resources": {
          "limits": {
            "cpus": "2.0",
            "memory": "4096M"
          }
        }
      }
    },
    "immich-redis": {
      "image": "redis:6.2",
      "container_name": "immich_redis_lite",
      "healthcheck": {
        "test": "redis-cli ping || exit 1"
      },
      "networks": [
        "default"
      ],
      "labels": {
        "runtipi.managed": "true",
        "runtipi.appurn": "immich-lite"
      },
      "restart": "unless-stopped"
    },
    "immich-db": {
      "image": "ghcr.io/immich-app/postgres:14-vectorchord0.3.0-pgvectors0.2.0",
      "container_name": "immich_db_lite",
      "volumes": [
        "${APP_DATA_DIR}/data/db:/var/lib/postgresql/data"
      ],
      "environment": {
        "POSTGRES_PASSWORD": "${APP_PASSWORD}",
        "POSTGRES_USER": "tipi",
        "POSTGRES_DB": "immich",
        "PG_DATA": "/var/lib/postgresql/data"
      },
      "networks": [
        "default"
      ],
      "labels": {
        "runtipi.managed": "true",
        "runtipi.appurn": "immich-lite"
      },
      "restart": "unless-stopped",
      "deploy": {
        "resources": {
          "limits": {
            "cpus": "2.0",
            "memory": "2048M"
          }
        }
      }
    }
  },
  "networks": {
    "tipi_main_network": {
      "external": true
    }
  }
}